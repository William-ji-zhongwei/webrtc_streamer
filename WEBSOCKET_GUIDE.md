# WebSocket ç‰ˆæœ¬ä½¿ç”¨æŒ‡å—

WebSocket ç‰ˆæœ¬æ”¯æŒæµè§ˆå™¨å’Œå¤šå®¢æˆ·ç«¯è¿æ¥ï¼Œæ¯” TCP Socket ç‰ˆæœ¬æ›´çµæ´»ã€‚

## ğŸ“¦ å®‰è£…ä¾èµ–

```bash
pip install aiortc opencv-python numpy websockets aiohttp
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ 1ï¼šä½¿ç”¨æµè§ˆå™¨ï¼ˆæœ€ç®€å•ï¼‰

1. **å¯åŠ¨ WebSocket æœåŠ¡å™¨**
   ```bash
   python receiver_websocket.py
   ```

2. **æ‰“å¼€æµè§ˆå™¨è®¿é—®**
   ```
   http://localhost:8080
   ```

3. **åœ¨ç½‘é¡µä¸Šæ“ä½œ**
   - ç‚¹å‡»"æ‰“å¼€æ‘„åƒå¤´"
   - ç‚¹å‡»"è¿æ¥å¹¶å‘é€"
   - æœåŠ¡å™¨ä¼šå¼¹å‡º OpenCV çª—å£æ˜¾ç¤ºæ¥æ”¶åˆ°çš„è§†é¢‘

### æ–¹å¼ 2ï¼šä½¿ç”¨ Python å®¢æˆ·ç«¯

1. **å¯åŠ¨æœåŠ¡å™¨**
   ```bash
   python receiver_websocket.py --port 8080
   ```

2. **å¯åŠ¨å‘é€ç«¯**
   ```bash
   python sender_websocket.py --server ws://localhost:8080/ws
   ```

## ğŸ“ é…ç½®è¯´æ˜

### æœåŠ¡å™¨ç«¯ (receiver_websocket.py)

```bash
python receiver_websocket.py \
    --host 0.0.0.0 \
    --port 8080 \
    --stun 106.14.31.123:3478 \
    --turn 106.14.31.123:3478 \
    --turn-user rxjqr \
    --turn-pass rxjqrTurn123
```

å‚æ•°è¯´æ˜ï¼š
- `--host`: ç›‘å¬åœ°å€ï¼ˆ0.0.0.0 è¡¨ç¤ºæ‰€æœ‰ç½‘ç»œæ¥å£ï¼‰
- `--port`: HTTP/WebSocket ç«¯å£ï¼ˆé»˜è®¤ 8080ï¼‰
- `--stun`: STUN æœåŠ¡å™¨åœ°å€
- `--turn`: TURN æœåŠ¡å™¨åœ°å€
- `--turn-user`: TURN ç”¨æˆ·å
- `--turn-pass`: TURN å¯†ç 

### å®¢æˆ·ç«¯ (sender_websocket.py)

```bash
python sender_websocket.py \
    --server ws://192.168.1.100:8080/ws \
    --device 0 \
    --stun 106.14.31.123:3478 \
    --turn 106.14.31.123:3478 \
    --turn-user rxjqr \
    --turn-pass rxjqrTurn123
```

å‚æ•°è¯´æ˜ï¼š
- `--server`: WebSocket æœåŠ¡å™¨åœ°å€
- `--device`: æ‘„åƒå¤´è®¾å¤‡ ID
- å…¶ä»–å‚æ•°åŒæœåŠ¡å™¨ç«¯

## ğŸŒ è¿œç¨‹è®¿é—®é…ç½®

### åœ¨å…¬ç½‘æœåŠ¡å™¨ä¸Šè¿è¡Œ

```bash
# åœ¨ 106.14.31.123 ä¸Šè¿è¡Œ
python receiver_websocket.py --host 0.0.0.0 --port 8080
```

### å®¢æˆ·ç«¯è¿æ¥

```bash
# ä»ä»»ä½•åœ°æ–¹è¿æ¥
python sender_websocket.py --server ws://106.14.31.123:8080/ws
```

### æˆ–åœ¨æµè§ˆå™¨ä¸­è®¿é—®

```
http://106.14.31.123:8080
```

## ğŸ”§ ä¸ TCP Socket ç‰ˆæœ¬çš„åŒºåˆ«

| ç‰¹æ€§ | TCP Socket | WebSocket |
|------|-----------|-----------|
| æµè§ˆå™¨æ”¯æŒ | âŒ | âœ… |
| å¤šå®¢æˆ·ç«¯ | âŒ | âœ… |
| Web UI | âŒ | âœ… |
| é˜²ç«å¢™ç©¿é€ | âš ï¸ | âœ… |
| å®æ—¶æ€§ | â­â­â­â­â­ | â­â­â­â­â­ |
| å¤æ‚åº¦ | â­ | â­â­ |

## ğŸ“Š æ¶æ„è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         WebSocket          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â”‚         (ä¿¡ä»¤äº¤æ¢)          â”‚              â”‚
â”‚  å‘é€ç«¯      â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚  æœåŠ¡å™¨      â”‚
â”‚ (Python/Web) â”‚                            â”‚  (Python)    â”‚
â”‚              â”‚         WebRTC             â”‚              â”‚
â”‚              â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      (åª’ä½“ä¼ è¾“)            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    é€šè¿‡ STUN/TURN
```

**ä¿¡ä»¤æµç¨‹ï¼š**
1. å®¢æˆ·ç«¯é€šè¿‡ WebSocket è¿æ¥åˆ°æœåŠ¡å™¨
2. å®¢æˆ·ç«¯å‘é€ Offer (SDP)
3. æœåŠ¡å™¨å›å¤ Answer (SDP)
4. äº¤æ¢ ICE å€™é€‰
5. å»ºç«‹ WebRTC è¿æ¥
6. å¼€å§‹ä¼ è¾“è§†é¢‘

## ğŸ” å®‰å…¨å»ºè®®

ç”Ÿäº§ç¯å¢ƒå»ºè®®ï¼š

1. **ä½¿ç”¨ HTTPS/WSS**
   ```bash
   # ä½¿ç”¨ SSL è¯ä¹¦
   python receiver_websocket.py --ssl-cert cert.pem --ssl-key key.pem
   ```

2. **æ·»åŠ èº«ä»½éªŒè¯**
   ```python
   # åœ¨ handle_websocket ä¸­æ·»åŠ  token éªŒè¯
   ```

3. **é™åˆ¶è¿æ¥æ•°**
   ```python
   # è®¾ç½®æœ€å¤§å®¢æˆ·ç«¯æ•°é‡
   ```

## ğŸ› æ•…éšœæ’é™¤

### æµè§ˆå™¨æ— æ³•è¿æ¥

1. æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ 8080 ç«¯å£
   ```bash
   sudo ufw allow 8080/tcp
   ```

2. æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦åœ¨è¿è¡Œ
   ```bash
   netstat -tuln | grep 8080
   ```

### è§†é¢‘æ— æ³•æ˜¾ç¤º

1. æ£€æŸ¥æ‘„åƒå¤´æƒé™ï¼ˆæµè§ˆå™¨ï¼‰
2. æ£€æŸ¥ TURN æœåŠ¡å™¨é…ç½®
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯

### ICE è¿æ¥å¤±è´¥

1. éªŒè¯ STUN/TURN æœåŠ¡å™¨å¯è®¿é—®
   ```bash
   stunclient 106.14.31.123 3478
   ```

2. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
   ```bash
   # å¼€æ”¾ WebRTC åª’ä½“ç«¯å£
   sudo ufw allow 49152:65535/udp
   ```

## ğŸ“š ç¤ºä¾‹åœºæ™¯

### åœºæ™¯ 1ï¼šæœ¬åœ°æµ‹è¯•

```bash
# ç»ˆç«¯ 1: å¯åŠ¨æœåŠ¡å™¨
python receiver_websocket.py

# æµè§ˆå™¨è®¿é—®: http://localhost:8080
```

### åœºæ™¯ 2ï¼šå±€åŸŸç½‘æµ‹è¯•

```bash
# æœåŠ¡å™¨ (192.168.1.100)
python receiver_websocket.py --host 0.0.0.0

# å®¢æˆ·ç«¯
python sender_websocket.py --server ws://192.168.1.100:8080/ws
```

### åœºæ™¯ 3ï¼šå…¬ç½‘éƒ¨ç½²

```bash
# æœåŠ¡å™¨ (106.14.31.123)
python receiver_websocket.py --host 0.0.0.0 --port 80

# ä»»ä½•åœ°æ–¹çš„æµè§ˆå™¨è®¿é—®
http://106.14.31.123
```

## ğŸ¯ ä¸‹ä¸€æ­¥

- æ·»åŠ éŸ³é¢‘æ”¯æŒ
- å®ç°å±å¹•å…±äº«
- æ·»åŠ å½•åˆ¶åŠŸèƒ½
- å®ç°æˆ¿é—´/é¢‘é“åŠŸèƒ½
- é›†æˆæ•°æ®é€šé“(DataChannel)
